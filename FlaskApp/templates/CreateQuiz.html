<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Quiz Game</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }

        .container {
            display: flex;
            width: 100%;
        }

        .sidebar {
            background-color: #0f3051;
            color: #ECF0F1;
            padding: 20px;
            width: 200px;
        }

        .quiz-area {
            padding: 20px;
            flex-grow: 1;
            background-color: #ECF0F1;
            position: relative;
        }

        .question-container {
            margin: 20px 0;
            font-size: 1.5em;
        }

        .options {
            width: 60%;
            display: flex;
            flex-direction: column;
        }

        .option {
            background-color: white;
            color: black;
            border: 2px solid #3498DB;
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            border-radius: 5px;
        }

        .option:hover {
            background-color: #f0f0f0;
        }

        .selected {
            border-color: grey;
            background-color: #f0f0f0;
        }

        #next-btn {
            background-color: #27AE60;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        #next-btn:hover {
            background-color: #219653;
        }

        #gratitude-message, #result {
            margin-top: 20px;
            font-size: 1.2em;
        }

        #show-results {
            margin-top: 20px;
            background-color: #3498DB;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        #show-results:hover {
            background-color: #2980B9;
        }

        .question-node {
            margin: 5px 0;
            padding: 5px;
            border: 1px solid #7F8C8D;
        }

        .active {
            background-color: #E74C3C;
            color: white;
        }

        .inactive {
            background-color: #95A5A6;
            color: white;
        }

        #timer {
            font-size: 24px;
            font-weight: bold;
            color: black;
        }

        .blinking {
            animation: blinkingText 1s infinite;
        }

        @keyframes blinkingText {
            0% { color: red; }
            50% { color: transparent; }
            100% { color: red; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>Question Progress</h2>
            <ul id="question-list"></ul>
        </div>
        
        <div class="quiz-area">
            <div id="timer">Time left: 15 seconds</div>
            <div class="question-container">
                <div id="question">Question Text</div>
                <div class="options">
                    <div class="option" onclick="answerQuestion(0)">Option A</div>
                    <div class="option" onclick="answerQuestion(1)">Option B</div>
                    <div class="option" onclick="answerQuestion(2)">Option C</div>
                    <div class="option" onclick="answerQuestion(3)">Option D</div>
                </div>
            </div>
            <button id="next-btn" onclick="nextQuestion()">Next Question</button>
            <div id="gratitude-message" style="display: none;">Thank you for participating!</div>
            <button id="show-results" style="display: none;" onclick="displayResult()">Show Results</button>
            <div id="result" class="hidden"></div>
        </div>
    </div>

    <script>
        const questions = JSON.parse('{{ questions|safe }}');
        const options_a = JSON.parse('{{ options_a|safe }}');
        const options_b = JSON.parse('{{ options_b|safe }}');
        const options_c = JSON.parse('{{ options_c|safe }}');
        const options_d = JSON.parse('{{ options_d|safe }}');
        const correct_answers = JSON.parse('{{ correct_answers|safe }}'); // Correct answers from server
                
        let currentQuestionIndex = 0;
        let timePerQuestion = 15; // 10 seconds per question
        let timeLeft = timePerQuestion;
        let userAnswers = [];
        let timerInterval;

        function startQuiz() {
            displayQuestion();
            displayQuestionList();
            startTimer(); // Start the timer when the quiz starts
        }

        function displayQuestion() {
            document.getElementById('question').innerText = `${currentQuestionIndex + 1}. ${questions[currentQuestionIndex]}`;
            document.querySelectorAll('.option')[0].innerText = options_a[currentQuestionIndex];
            document.querySelectorAll('.option')[1].innerText = options_b[currentQuestionIndex];
            document.querySelectorAll('.option')[2].innerText = options_c[currentQuestionIndex];
            document.querySelectorAll('.option')[3].innerText = options_d[currentQuestionIndex];
            updateQuestionList();
            resetTimer(); // Reset the timer for the next question
        }

        function updateQuestionList() {
            const questionList = document.getElementById('question-list');
            questionList.innerHTML = '';

            questions.forEach((question, index) => {
                const node = document.createElement('li');
                node.className = 'question-node ' + (index === currentQuestionIndex ? 'active' : 'inactive');
                node.innerHTML = `Question ${index + 1}`;
                questionList.appendChild(node);
            });
        }

        function answerQuestion(answerIndex) {
            userAnswers[currentQuestionIndex] = answerIndex;

            document.querySelectorAll('.option').forEach((option, index) => {
                option.classList.remove('selected');
                if (index === answerIndex) {
                    option.classList.add('selected');
                }
            });
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                displayQuestion();
            } else {
                clearInterval(timerInterval); // Stop the timer when all questions are answered
                displayGratitudeMessage(); // Display gratitude message after the last question
                document.getElementById('show-results').style.display = 'block'; // Show results button only after quiz ends
            }
        }


        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;

                const timerElement = document.getElementById('timer');
                timerElement.textContent = `Time left: ${timeLeft} seconds`;

                if (timeLeft === 5) {
                    alert("Only 5 seconds remaining!");
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval); // Stop the timer
                    nextQuestion(); // Move to the next question
                }
            }, 1000);
        }

        function resetTimer() {
            timeLeft = timePerQuestion;
            clearInterval(timerInterval); // Clear the existing interval
            startTimer(); // Start a new interval for the next question
        }

        function displayGratitudeMessage() {
            const gratitudeMessage = document.getElementById('gratitude-message');
            gratitudeMessage.style.display = 'block'; // Show the gratitude message
            gratitudeMessage.classList.remove('hidden');
        }


        const answerLetters = ["a", "b", "c", "d"]; 
        function displayResult() {
            let score = 0; // Initialize score

            const resultElement = document.getElementById('result');
            resultElement.innerHTML = ''; // Clear previous result content

            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index] !== undefined ? answerLetters[userAnswers[index]] : "No Answer";
                const correctAnswer = correct_answers[index];

                if (userAnswer === correctAnswer) {
                    score++;
                }

                const summary = document.createElement('div');
                summary.className = 'answer-summary';
                summary.innerHTML = `
                    <strong>Question ${index + 1}:</strong> ${questions[index]}<br>
                    Your answer: <span style="color: ${userAnswer === correctAnswer ? 'green' : 'red'};">${userAnswer}</span><br>
                    Correct answer: ${correctAnswer}
                `;
                resultElement.appendChild(summary);
            });
            
            resultElement.insertAdjacentHTML('afterbegin', `You got ${score} out of ${questions.length} correct!`);
            resultElement.classList.remove('hidden');
        }

        startQuiz();
    </script>
</body>
</html>
